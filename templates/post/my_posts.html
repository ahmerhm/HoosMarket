{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ title|default:"Dashboard" }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, Helvetica, sans-serif;
            background-color: #f8f9fa;
        }

        nav {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: #082d52;
            color: white;
            padding: 0.75rem 2rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .site-name {
            font-size: 1.5rem;
            font-weight: bold;
            letter-spacing: 0.5px;
        }
        
        .site-name a {
            color: white;
            text-decoration: none;
        }

        .site-name a:hover {
            color:#29b1f0;
        }

        .nav-links {
            display: flex;
            gap: 1.5rem;
        }

        .nav-links a {
            color: white;
            text-decoration: none;
            font-size: 1rem;
            transition: color 0.3s ease;
        }

        .nav-links a:hover {
            color: #29b1f0;
        }

        .content {
            height: calc(100vh - 70px); 
            background-color: white;
            padding: 2rem;
        }

        .avatar {
            width:40px;
            height:40px;
            border-radius:50%;
            background-size:cover;
            background-position:center;
            overflow:hidden;
            display:flex;
            align-items:center;
            justify-content:center;
            margin-right:1rem;
            background-color:#404243;
        }

        .delete-btn {
            background:#e53e3e;
            color:#fff;
            border:none;
            padding:8px 14px;
            border-radius:8px;
            text-decoration:none;
        }
        
        .delete-btn:hover { background:#c53030; }

        .post-category {
            font-size: 0.8rem;
            color: #777777;
            font-weight: 300;
        }

        .posts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1rem;
        }

        .post {
            border: 2px solid #ccc;
            padding: 1rem;
            border-radius: 6px;
            background: #fafafa;
            display: flex;
            flex-direction: column;
        }
    </style>
</head>
<body>

    <nav>
        <div class="site-name">
            <a href="/" class="site-link">Hoos Market</a>
        </div>
        <div class="nav-links">
            <a href="{% url 'newpost' %}">New Post</a>
            <a href="{% url 'messaging:inbox' %}">Messages</a>
            <a href="/myaccount/">My Account</a>
            {% if user.is_staff %}
                <a href="{% url 'admin_dashboard' %}">Review content</a>
            {% endif %}
        </div>
    </nav>

    <div class="wrap">
      <div class="header" style="justify-content: center;margin-top:1.5rem;">
          <h2 style="text-align:center;width:100%;color:#000000;">My Posts</h2>
      </div>

      <div class="content">
          <div class="posts-grid">
              {% for post in posts %}
              <div class="post">

                  <div style="display:flex; align-items:center; margin-bottom:1rem;">
                      <div class="avatar"
                          {% if post.user.profile.avatar %}
                              style="background-image:url('{{ post.user.profile.avatar.url }}');"
                          {% endif %}
                      >
                          {% if not post.user.profile.avatar %}
                              <span style="font-size:2rem; opacity:0.4;">ðŸ“·</span>
                          {% endif %}
                      </div>

                      <div>
                          <h3 style="margin:0;">
                              {% if post.user.get_full_name %}
                                  {{ post.user.get_full_name }}
                              {% else %}
                                  {{ post.user.username }}
                              {% endif %}
                          </h3>
                      </div>
                  </div>

                  <h3 style="margin:0 0 .5rem 0;">${{ post.price }}</h3>

                  {% if post.images.all %}
                      <div style="margin-bottom:.75rem;">
                          {% for img in post.images.all %}
                              <img src="{{ img.image.url }}"
                                  alt="Post image"
                                  style="width:100px; height:100px; object-fit:cover; margin-right:5px; border-radius:4px;">
                          {% endfor %}
                      </div>
                  {% endif %}

                  <h3 style="margin-bottom:.25rem;">{{ post.title }}</h3>
                  <p>{{ post.description }}</p>
                  <p><span class="post-category">{{ post.get_category_display }}</span></p>

                  <form method="POST" action="{% url 'delete_post' %}" style="margin-top:1rem;" onsubmit="return confirmDelete();">
                      {% csrf_token %}
                      <input type="hidden" name="post_id" value="{{ post.id }}">
                      <button type="submit" class="delete-btn">Delete</button>
                  </form>

              </div>
              {% empty %}
                  <p>No posts yet.</p>
              {% endfor %}
          </div>
      </div>
    </div>

    <script>
    function confirmDelete() {
        return confirm("Confirm that you want to delete this post");
    }
    </script>

</body>
</html>
